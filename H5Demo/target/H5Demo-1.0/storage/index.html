<html>
<title>离线存储</title>
<meta charset="UTF-8" />
<script>
    console.info(localStorage.length);
    console.info(localStorage.key(0));
    localStorage.setItem('foo', 'bar');
    console.info(localStorage.getItem('foo'));
    console.info(localStorage.key(0));
    localStorage.removeItem('foo');
    console.info(localStorage.getItem('foo'));
    localStorage.clear();
    console.info('-------------------')

    console.info(sessionStorage.getItem('foo'));
    sessionStorage.setItem('foo','bar');
</script>

<script type="text/javascript">
    var db = openDatabase('testDB', '1.0', 'Test DB', 2 * 1024 * 1024);
    var msg;
    db.transaction(function (context) {
        context.executeSql('CREATE TABLE IF NOT EXISTS testTable (id unique, name)');
        context.executeSql('INSERT INTO testTable (id, name) VALUES (0, "Byron")');
        context.executeSql('INSERT INTO testTable (id, name) VALUES (1, "Casper")');
        context.executeSql('INSERT INTO testTable (id, name) VALUES (2, "Frank")');
    });

    db.transaction(function (context) {
        context.executeSql('SELECT * FROM testTable', [], function (context, results) {
            console.info(results);
            var len = results.rows.length, i;
            console.log('Got '+len+' rows.');
            for (i = 0; i < len; i++){
                console.log('id: '+results.rows.item(i).id);
                console.log('name: '+results.rows.item(i).name);
            }
            console.info("-------------------------");
        });
    });
</script>


<script>

    function openDB (name,version) {
        var version=version || 1;
        var request=window.indexedDB.open(name,version);
        request.onerror=function(e){
            console.log(e.currentTarget.error.message);
        };
        request.onsuccess=function(e){
            myDB.db=e.target.result;
        };
        request.onupgradeneeded=function(e){
            var db=e.target.result;
            if(!db.objectStoreNames.contains('students')){
                db.createObjectStore('students',{autoIncrement: true});
            }
            console.log('DB version changed to '+version);
        };
    }

    function closeDB(db){
        db.close();
    }

    function deleteDB(name){
        indexedDB.deleteDatabase(name);
    }


    var myDB={
        name:'test',
        version:3,
        db:null
    };

    var students=[{
        id:1001,
        name:"Byron",
        age:24
    },{
        id:1002,
        name:"Frank",
        age:30
    },{
        id:1003,
        name:"Aaron",
        age:26
    }];

    function addData(db,storeName){
        var transaction=db.transaction(storeName,'readwrite');
        var store=transaction.objectStore(storeName);

        for(var i=0;i<students.length;i++){
            store.add(students[i]);
        }
    }

    function getDataByKey(db,storeName,value){
        var transaction=db.transaction(storeName,'readwrite');
        var store=transaction.objectStore(storeName);
        var request=store.get(value);
        request.onsuccess=function(e){
            var student=e.target.result;
            console.log(student.name);
        };
    }


    openDB(myDB.name,myDB.version);
    setTimeout(function(){
        addData(myDB.db,'students');
        getDataByKey(myDB.db,'students',1);
    },1000);

</script>
<br>
Web SQL Database 和 Indexed Database 都是在客户端存储大量结构化数据的解决方案。</br>
Web SQL Database 实现了传统的基于 SQL 语句的数据库操作，</br>
而 Indexed Database 实现了 NoSQL 的存储方式 </br>

</body>
</html>
